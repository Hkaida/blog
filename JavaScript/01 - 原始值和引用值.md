# JavaScript 原始值和引用值



JavaScript 中的变量是松散类型（弱类型）的，没有规则定义某个变量必须是什么数据类型，因此变量的值和数据类型在程序运行过程中可以改变。

JavaScript 存储在变量中的数据类型可以分成两种：

**原始值**：Number、String、Boolean、Undefined、Null、Symbol

**引用值**：Object（其中包括 Array、Function 等等）



## 数据的存储

**原始值**是直接存储在**栈(stack)**中的简单数据段，占据空间小、大小比较稳定，属于被频繁使用数据，所以放入栈中存储。

**引用值**是存储在**堆(heap)**中的对象，占用空间大，大小不固定。同时会在栈中存储一个该对象在堆内存中的内存地址（指针）。

![](E:\2-web前端\个人作品集\my博客图片\JavaScript\JavaScript-01-1.png)



## 值的可变性

在 JavaScript 中，原始值是不可变的，也就是说没有办法去修改一个原始值的本身。原始值只能进行重新赋值操作，这时候会销毁原来的值，并重新分配内存地址保存新的值，变量指向的内存地址产生了变化。

这对于字符串来说可能并不是那么明显，因为字符串看起来像是由字符组成的的数组，并且也可以通过指定索引来获取某个字符，但是能否以此修改字符串中的字符呢，实际上，JavaScript 是禁止这样做的。

```javascript
let str = "hello";
console.log(str[0]); // "h"

str[0] = "H";
console.log(str); // "hello"
```

字符串中的一些方法看似返回了修改后的字符串，实际上返回的是一个新的值，原始字符串的值并未改变。

```javascript
str.toUpperCase(); // 返回 "HELLO"
console.log(str); // "hello"
```



而引用值是可变的——引用值可以随时添加、删除和修改其属性和方法，始终指向同一个对象。

```javascript
let obj = {};
obj.x = 1;
console.log(obj); // {x: 1}

let arr = ["a", "b", "c"];
arr[3] = "d";
console.log(arr); // ["a", "b", "c", "d"]
```



区分可变和不可变的关键就是**同一个变量对应存储数据的内存地址有没有变化。**



## 复制值

原始值和引用值在通过变量复制时，行为也有所不同。原始值通过一个变量赋值给另一个变量时，原始值会创建一个新的副本，这两个变量可以独立使用，互不干扰。

```JavaScript
let num1 = 5;
let num2 = num1;

num2 += 1;
console.log(num1, num2); // 5  6
```

原始值的复制过程如下图：



把引用值通过一个变量赋值给另一个变量时，复制的是栈中的指针，因此两个变量实际上是指向了堆中的同一个对象。对其中一个变量进行改动，也会影响另一个变量。

```JavaScript
let obj1 = {};
let obj2 = obj1;

obj1.name = "小明";
console.log(obj2); // { name: "小明" }
```

引用值的复制过程如下图：





## 参数传递

ECMAScript 中，给函数传递参数时，相当于从一个变量赋值到另一个变量。





## 总结

原始值特点：

1. 原始值是不可变的，对原始值进行看似修改的操作，实质是销毁该值然后重新赋值。
2. 原始值大小固定，因此保存在栈内存中。
3. 通过变量赋值复制时，会创建该值的副本。

引用值特点：

1. 引用值是可变的，可以对值的本身进行修改。
2. 引用值是对象，大小不固定，保存在堆内存中，并且会在栈内存中保存指向这个对象的指针（引用）。
3. 通过变量赋值复制时，仅仅复制指向对象的指针，结果是两个变量都指向同一个对象。



